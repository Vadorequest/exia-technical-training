<header class="navbar navbar-default col-sm-12" role="navigation">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <% if(currentUser.connected){ %>
            <button id="return_home">
                <span class="sr-only">Previous level</span>
                <i class="fa fa-arrow-left"></i>
            </button>
        <% } %>
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".bs-example-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <i class="fa fa-navicon"></i>
        </button>
        <a class="navbar-brand" href="/" title="Ayolan-Translation" data-toggle="tooltip" data-placement="bottom">
            <i class="fa fa-rebel"></i>
            <span class="hidden-xxs">&nbsp;&nbsp;&nbsp;Ayolan-Translation</span>
        </a>
    </div>

    <!-- Search bar -->
    <div class="collapse navbar-collapse navbar-left bs-example-navbar-collapse">
        <ul class="nav navbar-nav">
            <li role="menuitem">
                <a id="link_search" href="#" title="Do a search" data-toggle="tooltip" data-placement="bottom">
                    <i class="fa fa-search"></i>
                    <span class="hidden-sm">&nbsp;&nbsp;&nbsp;Search</span>
                </a>
            </li>
            <% if(currentUser.connected){ %>
                <li role="menuitem">
                    <a id="link_sentence" href="#" title="Create a new sentence" data-toggle="tooltip" data-placement="bottom">
                        <i class="fa fa-suitcase"></i>
                        <span class="hidden-sm">&nbsp;&nbsp;&nbsp;New sentence</span>
                    </a>
                </li>
                <li role="menuitem">
                    <a id="link_translation" href="#" title="Create a new translation" data-toggle="tooltip" data-placement="bottom">
                        <i class="fa fa-comments-o"></i>
                        <span class="hidden-sm">&nbsp;&nbsp;&nbsp;New translation</span>
                    </a>
                </li>
            <% } %>
        </ul>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-right bs-example-navbar-collapse">
        <ul class="nav navbar-nav">
            <% if(!currentUser.connected){ %>
                <li role="menuitem">
                    <a id="link_subscription" href="#" title="Create an account on the game" data-toggle="tooltip" data-placement="bottom">
                        <i class="fa fa-edit"></i>
                        <span class="hidden-sm">&nbsp;&nbsp;&nbsp;Sign up</span>
                    </a>
                </li>
                <li role="menuitem">
                    <a id="link_authentication" href="#" title="Log in" data-toggle="tooltip" data-placement="bottom">
                        <i class="fa fa-sign-in"></i>
                        <span class="hidden-sm">&nbsp;&nbsp;&nbsp;Log in</span>
                    </a>
                </li>
            <% } else { %>
                <li role="menuitem">
                    <a id="link_account" href="#" title="Account" data-toggle="popover" data-placement="bottom">
                        <i class="fa fa-user"></i>
                        <span class="visible-xs-inline">&nbsp;&nbsp;&nbsp;Account</span>
                    </a>
                    <div class="content hide" role="menu">
                        <ul class="popover-list-item-group">
                            <li role="menuitem">
                                <a id="link_profile" href="#" class="popover-list-item" title="Access to your account" data-toggle="tooltip" data-placement="bottom">
                                    <i class="fa fa-wrench"></i>
                                    <span>&nbsp;&nbsp;Profile</span>
                                </a>
                            </li>
                            <li role="menuitem">
                                <a id="link_pm" href="#" class="popover-list-item" title="Check your messages" data-toggle="tooltip" data-placement="bottom">
                                    <i class="fa fa-envelope"></i>
                                    <span>&nbsp;&nbsp;Personnal message</span>
                                </a>
                            </li>
                        </ul>
                        <ul class="popover-list-item-group">
                            <li role="menuitem">
                                <a id="link_help" href="#" class="popover-list-item" title="Go to help form" data-toggle="tooltip" data-placement="bottom">
                                    <i class="fa fa-question"></i>
                                    <span>&nbsp;&nbsp;Help</span>
                                </a>
                            </li>
                            <li role="menuitem">
                                <a id="link_log_off" href="#" class="popover-list-item" title="Log out" data-toggle="tooltip" data-placement="bottom">
                                    <i class="fa fa-power-off"></i>
                                    <span>&nbsp;&nbsp;Log off</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            <% } %>
        </ul>
    </div><!-- /.navbar-collapse -->
</header>

<script>
    $( function () {

        // Insert an input into search link
        $( "#global > header #link_search" ).on( "click focus", function ( e ) {
            var
                linkIcon = "<i class='fa fa-search'></i>",
                newInput = $( "<input type='text' placeholder='Search...' /> ")
                                .attr( "class", "form-control" )
                                .on( "blur", function () {
                                    var content = "<i class='fa fa-search'></i><span class='hidden-sm'>&nbsp;&nbsp;&nbsp;Search</span>";

                                    $( this )
                                        .parent()
                                        .toggleClass( "searched" )
                                        .html( content );
                                } );

            $( this )
                .toggleClass( "searched" )
                .html( linkIcon )
                .append( newInput );
            $( this )
                .find( "input" )
                .focus();

            e.preventDefault();
        } );

        // Autofocus.
        $( "#global > header #link_search").focus();

        // Activate popover for #link_account
        $( "#global > header #link_account" ).popover( {
            animation: true,
            title: "TyrionGraphiste<p>@TyrionGraphiste</p>",
            content: function () {
                return $( this ).parent().find( "div.content" ).html();
            },
            html: true,
            delay: { "show": 0, "hide": 50 },
            container: "body"
        } );

        // Activate tooltip for each link element (a) with title
        $( "body" ).tooltip( {
                selector: "a[title]",
                trigger: 'hover focus',
                delay: { "show": 600, "hide": 50 },
                title: "Manage your Account.",
                container: "body" // This option is particularly useful in that it allows you to position the tooltip in the flow of the document near the triggering element - which will prevent the tooltip from floating away from the triggering element during a window resize.
        } );

        // Dismiss a popover by clicking outside
        $( window ).on( "click resize scroll contextmenu", function ( e ) {
            $( "[data-toggle='popover']" ).each( function () {
                if ( !$( this ).is( e.target ) && $( this ).has( e.target ).length === 0 && $( ".popover" ).has( e.target ).length === 0 ) {
                    $( this ).popover( "hide" );
                }
            } );
        } );

    } );
</script>